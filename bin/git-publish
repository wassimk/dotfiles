#!/usr/bin/env ruby
#
# Usage: git publish [remote-branch-name]
# Pushes the current branch to origin remote with upstream tracking.
# Accepts an optional remote-branch-name param. Otherwise, uses current branch.

def remote_branch
  @remote_branch ||= (ARGV[0] || current_branch)
end

def current_branch
  @current_branch ||= `git rev-parse --abbrev-ref HEAD`.chomp
end

def main
  if %(master staging).include? current_branch
    $stderr.puts "Currently on #{current_branch}, aborting."
    exit 1
  else
    system("git push -u origin #{current_branch}:#{remote_branch}")
  end
end

main
